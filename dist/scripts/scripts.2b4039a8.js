"use strict";function BopFinderFooter(){return{templateUrl:"views/footer.html",restrict:"EA"}}function BopFinderNavbar(){return{templateUrl:"views/navbar.html",controller:"NavCtrl",controllerAs:"nav",bindToController:!0,restrict:"EA"}}function BopFinderTrack(){return{templateUrl:"views/track.html",restrict:"EA"}}function Music(){var a=this;a.audio={},a.track_id=-1,a.play=function(b){a.audio.duration>0&&!a.audio.paused&&b.id===a.track_id?a.audio.pause():a.audio.duration>0&&a.audio.paused&&b.id===a.track_id?a.audio.play():a.audio.duration>0&&!a.audio.paused&&b.id!==a.track_id?(a.audio.pause(),a.audio=new Audio(b.preview_url),a.audio.play(),a.track_id=b.id):(a.audio=new Audio(b.preview_url),a.audio.play(),a.track_id=b.id)}}function Markets(a,b){var c={};return c.getMarketByIP=function(){function c(a){return{country:a.data.country.toLowerCase(),code:a.data.countryCode.toLowerCase()}}function d(a){return b.error(a),b.warn("XHR Failed for getMarketByIP. Loading default as US."),{country:"united states",code:"us"}}return a.get("http://ip-api.com/json").then(c)["catch"](d)},c.getMarkets=function(){function c(a){return a.data}function d(a){return b.error(a),b.error("XHR Failed for getMarkets."),[]}return a.get("scripts/countries.json").then(c)["catch"](d)},c.setCurrent=function(a){c.current=a},c.getCurrent=function(){return c.current},c}function ArtistSearch(a,b,c,d){var e=this;e.search=function(a){function e(a){return a.data.artists.items}function f(a){return b.error("XHR Failed for ArtistSearch search."+a.data),[]}return c.search(a.trim(),"artist",{country:d.current.code}).then(e)["catch"](f)}}function TrackList(a,b,c){function d(e,f){function g(a){function b(a){return c.concat(a)}var c=a.data.items.map(function(a){return a.id});return f+50<=a.data.total?d(e,f+50).then(b):c}function h(b){a.error(b)}return b.getArtistAlbums(e,{album_type:"album,single",country:c.current.code,offset:f,limit:50}).then(g)["catch"](h)}function e(a){for(var b=0;b<a.length;b+=20)a.slice(b,b+20).forEach(f)}function f(d){function e(b){return a.info(b),b}function f(b){return a.error(b),[]}return b.getAlbums(d,{country:c.current.code}).then(e)["catch"](f)}var g=this;g.getTopTracks=function(a){d(a,0).then(e)}}angular.module("bopFinder",["ngAnimate","ngRoute","ngSanitize","ui.bootstrap","spotify"]).config(["$locationProvider","$routeProvider","SpotifyProvider",function(a,b,c){a.hashPrefix(""),a.html5Mode(!0),b.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"}),c.setClientId("c8b41b06c1734f0987f8ee45de21ad32"),c.setRedirectUri("views/callback.html"),c.setScope("user-read-private playlist-modify playlist-modify-private")}]),angular.module("bopFinder").controller("MainCtrl",["$scope","$http","$window","markets","Spotify","artistSearch","trackList",function(a,b,c,d,e,f,g){var h=this;h.searchSelected="",h.topTracks=[];var i="",j=function(){var a="[BOP FINDER] "+h.artist.name;e.createPlaylist(i.id,{name:a}).then(function(a){e.addPlaylistTracks(i.id,a.data.id,h.topTracks.map(function(a){return a.id})).then(function(a){console.log(a)})})};h.logIn=function(){""===i||null===i||void 0===i?e.login().then(function(){e.setAuthToken(c.localStorage.getItem("spotify-token")),e.getCurrentUser().then(function(a){i=a.data,j()})}):null===c.localStorage.getItem("spotify-token")||""!==i&&null!==i&&void 0!==i?j():(e.setAuthToken(c.localStorage.getItem("spotify-token")),e.getCurrentUser().then(function(a){i=a.data,j()}))},h.getTracks=function(a){var b=a.tracks.items.length>50?a.tracks.items.splice(0,50).map(function(a){return a.id}):a.tracks.items.map(function(a){return a.id});e.getTracks(b,{country:d.current.code}).then(function(b){var c=b.data.tracks;c.sort(function(a,b){return b.popularity-a.popularity});for(var d=Math.ceil(.15*a.tracks.items.length),e=0;d>e;e++)h.topTracks.push(c[e])})},h.onSelect=function(a){h.artist=a,g.getTopTracks(h.artist.id),e.getArtistAlbums(h.artist.id,{album_type:"album,single",country:d.current.code,limit:20}).then(function(a){e.getAlbums(a.data.items.map(function(a){return a.id}),{country:d.current.code}).then(function(a){var b=a.data.albums;b.sort(function(a,b){return b.popularity-a.popularity});for(var c={},d=0;d<b.length;d++)b[d].name.replace(/ *\([^)]*\) */g,"")in c?b.splice(d,1):c[b[d].name.replace(/ *\([^)]*\) */g,"")]="exists";var e,f,g=-1,i=-1;b.length%2===0?(g=b[b.length/2].popularity,b.length%4===0?i=b[b.length-b.length/4].popularity:(e=b.length-Math.ceil(b.length/4),f=b.length-Math.floor(b.length/4),i=e>=b.length?b[f].popularity:Math.floor((b[e].popularity+b[f].popularity)/2))):(e=Math.ceil(b.length/2),f=Math.floor(b.length/2),g=Math.floor((b[e].popularity+b[f].popularity)/2),e=b.length-Math.ceil(b.length/4),f=b.length-Math.floor(b.length/4),i=e>=b.length?b[f].popularity:Math.floor((b[e].popularity+b[f].popularity)/2));var j=0;h.topTracks=[];for(var k=0;k<b.length;k++)("single"===b[k].album_type&&b[k].popularity>g||"album"===b[k].album_type&&b[k].popularity>i)&&(setTimeout(h.getTracks(b[k]),1e3+j),j+=2e3)})})},h.getArtist=function(a){return f.search(a)}}]),angular.module("bopFinder").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("bopFinder").controller("NavCtrl",["markets",function(a){function b(){return c()}function c(){return a.getMarkets().then(function(a){return f.markets.countries=a,f.markets.countries})}function d(){return e()}function e(){return a.getMarketByIP().then(function(b){return f.markets.current=b,a.setCurrent(b),f.markets.current})}var f=this;f.markets=[],b(),d(),f.selectCountry=function(b){a.setCurrent(b)}}]),angular.module("bopFinder").directive("bopFinderFooter",BopFinderFooter),angular.module("bopFinder").directive("bopFinderNavbar",BopFinderNavbar),angular.module("bopFinder").directive("bopFinderTrack",BopFinderTrack),angular.module("bopFinder").service("music",Music),angular.module("bopFinder").factory("markets",Markets),Markets.$inject=["$http","$log"],angular.module("bopFinder").service("artistSearch",ArtistSearch),ArtistSearch.$inject=["$http","$log","Spotify","markets"],angular.module("bopFinder").service("trackList",TrackList),TrackList.$inject=["$log","Spotify","markets"],angular.module("bopFinder").run(["$templateCache",function(a){a.put("views/about.html",'<div class="container"> <div class="row"> <div class="col-md-6 col-md-offset-3"> <h2>About Bop Finder</h2> <p><strong>Bop Finder</strong> generates a Spotify playlist of an artist\'s top hits from their entire discography. Spotify\'s current "Popular" listing on an artist\'s page only lists ten songs, and is often overwhelmed by their most recent release. <strong>Bop Finder</strong> takes the top songs from each major release, giving a longer and more diverse overview of their hits.</p> <p><strong>Bop Finder</strong> was created by <a href="https://github.com/praisecatgod">Yves St. Germain</a>, a software engineer who really loves music and cats.</p> </div> </div> </div>'),a.put("views/callback.html",'<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title></title> <script>window.onload = function () {\n      var hash = window.location.hash;\n      if (window.location.search.substring(1).indexOf("error") !== -1) {\n        // login failure\n        window.close();\n      } else if (hash) {\n        // login success\n'+"        var token = window.location.hash.split('&')[0].split('=')[1];\n        localStorage.setItem('spotify-token', token);\n      }\n    }</script> </head> <body> </body> </html>"),a.put("views/footer.html",'<div id="footer"> <div class="container"> <small> <p>created by <a href="https://github.com/praisecatgod">yves st. germain</a></p> <p> <a href="mailto:yv.desousa[at]gmail.com">Hire me?</a></p> </small> </div> </div>'),a.put("views/main.html",'<div class="text-center"> <div class="desc-row container-fluid"> <div class="row"> <div class="col-md-6 col-md-offset-3"> <div class="app-desc"> <h1>Bop Finder</h1> <p class="lead">Go beyond the top tracks, and get all the best hits from your next favorite artist\'s entire discography.</p> </div> <form class="form-horizontal"> <div class="col-md-6 col-md-offset-3"> <div class="form-group form-group-lg has-feedback typeahead-input"> <input type="text" class="form-control input-lg" placeholder="Type artist name here..." ng-model="main.searchSelected" uib-typeahead="artist.name for artist in main.getArtist($viewValue)" typeahead-on-select="main.onSelect($item)" typeahead-wait-ms="1000" typeahead-loading="loadingLocations" typeahead-no-results="noResults"> <span class="glyphicon glyphicon-refresh form-control-feedback" aria-hidden="true" ng-show="loadingLocations"></span> <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-show="noResults"></span> </div> </div> </form> </div> </div> </div> <div class="container"> <div class="row" ng-show="main.artist.name.length > 0"> <div class="col-md-6 col-md-offset-3"> <a ng-href="{{main.artist.external_urls.spotify}}"> <h2>{{main.artist.name}}</h2> </a> </div> </div> <div class="row" ng-show="main.artist.images.length > 0"> <div class="col-md-6 col-md-offset-3"> <a ng-href="{{main.artist.external_urls.spotify}}"> <img ng-src="{{main.artist.images[0].url}}" alt="{{main.artist.name}}" class="artist-photo"> </a> </div> </div> <div class="row" ng-show="main.topTracks.length > 0"> <div class="col-md-6 col-md-offset-3"> <button type="button" class="btn btn-spotify" ng-click="main.logIn()">Create A Spotify Playlist!</button> </div> </div> <div class="row"> <div class="col-md-6 col-md-offset-3"> <table class="table table-striped track-table"> <tr ng-repeat="track in main.topTracks | orderBy:\'-popularity\'"> <td bop-finder-track ng-model="track"> </td> </tr> </table> </div> </div> </div></div>'),a.put("views/navbar.html",'<nav class="navbar navbar-inverse"> <div class="container"> <div class="navbar-header"> <a class="text-uppercase navbar-brand" href="/">Bop Finder</a> </div> <ul class="nav navbar-nav navbar-right"> <li><a href="/about">About</a></li> <li class="dropdown" uib-dropdown on-toggle="toggled(open)"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" uib-dropdown-toggle> <img ng-src="images/flags/{{nav.markets.current.code}}.png" alt="{{nav.markets.current.name}}"> <span class="caret"></span></a> <ul class="dropdown-menu" uib-dropdown-menu> <li ng-repeat="c in nav.markets.countries"> <a href="#" ng-click="nav.selectCountry(c)"> <img ng-src="images/flags/{{c.code}}.png" alt="{{c.name}}"> {{c.code | uppercase}} </a> </li> </ul> </li> </ul> </div> </nav>'),a.put("views/track.html",'<div class="media"> <div class="media-left"> <div class="album" ng-style="{\'background-image\':\'url({{track.album.images[2].url}})\'}" ng-click="playAudio(track)"> <div class="buttons" style="display: block"> <span class="glyphicon glyphicon-play" ng-hide="true"></span> <span class="glyphicon glyphicon-pause" ng-show="!audio.paused && current_audio == track.id"></span> </div> </div> </div> <div class="media-body text-left"> <h4 class="media-heading"> <a ng-href="{{track.external_urls.spotify}}">{{track.name}}</a></h4> <span class="album-title"><a ng-href="{{track.album.external_urls.spotify}}">{{track.album.name}}</a></span></div> </div>')}]);